<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Holiday Inn ‚Äî Room Inspection Checklist</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Holiday Inn">

<style>
  :root{
    --bg:#f7f8fb;
    --card:#ffffff;
    --text:#1f2937;
    --muted:#6b7280;
    --shadow:0 10px 25px rgba(15,23,42,.18);
    --radius:22px;

    /* hub pastels */
    --p1:#bfe3ff;  /* blue */
    --p2:#ffd6e7;  /* pink */
    --p3:#d8ffd6;  /* green */
    --p4:#fff2bf;  /* yellow */
    --p5:#e6d6ff;  /* purple */
    --ring:#9acbff;

    --hubNotesBg:#f6f1ff;
    --hubNotesBorder:#e6ddff;
  }

  *{box-sizing:border-box;}

  body{
    margin:0;
    padding:18px;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:linear-gradient(135deg,#f5f7ff,#e5f6ff);
    color:var(--text);
  }

  .wrapper{ max-width:1040px; margin:0 auto; }

  h1{
    text-align:center;
    margin:6px 0 2px;
    font-size:1.8rem;
    letter-spacing:.04em;
  }

  .subtitle{
    text-align:center;
    font-size:.9rem;
    color:var(--muted);
    margin-bottom:10px;
  }

  .date-row{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:8px;
    margin-bottom:12px;
    font-size:.9rem;
    color:var(--text);
  }
  .date-row label{ font-weight:600; }
  .date-row input[type="date"]{
    padding:4px 8px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.7);
    font-size:.9rem;
    background:#f9fafb;
  }
  .date-row input[type="date"]:focus{
    outline:none;
    border-color:var(--ring);
    box-shadow:0 0 0 2px rgba(154,203,255,.55);
    background:#fff;
  }

  .card{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px 16px 20px;
    border:1px solid rgba(148,163,184,.35);
    overflow:hidden;
  }

  .card-header-band{
    background:linear-gradient(90deg,#e5edff,#fdf2ff);
    margin:-16px -16px 16px;
    padding:10px 16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }

  .card-header-text{
    font-size:.82rem;
    color:var(--muted);
    line-height:1.25;
    max-width:720px;
  }

  .header-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:flex-end;
  }

  .sync-pill{
    font-size:.75rem;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.45);
    background:#fff;
    color:#111827;
    white-space:nowrap;
  }

  .btn-pill{
    border:none;
    border-radius:999px;
    padding:7px 15px;
    font-size:.8rem;
    font-weight:600;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:6px;
    white-space:nowrap;
    box-shadow:0 6px 14px rgba(59,130,246,.35);
    transition:transform .08s ease, box-shadow .08s ease, opacity .08s ease;
  }
  .btn-pill span.icon{font-size:.9rem;}

  .btn-print{ background:#2563eb; color:#fff; }
  .btn-clear{
    background:#fee2e2;
    color:#991b1b;
    box-shadow:0 6px 14px rgba(248,113,113,.35);
  }
  .btn-pill:active{ transform:translateY(1px); box-shadow:none; opacity:.9; }

  .tabs{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:12px;
    justify-content:center;
  }

  .tab-btn{
    flex:1 1 90px;
    border:none;
    border-radius:999px;
    padding:8px 14px;
    font-size:.9rem;
    cursor:pointer;
    background:#e5ecff;
    color:#1f2937;
    max-width:160px;
    transition:transform .1s ease, box-shadow .1s ease, background .1s ease, color .1s ease;
  }

  .tab-btn[data-floor="2"]{ background:rgba(191,227,255,.9); }
  .tab-btn[data-floor="3"]{ background:rgba(255,214,231,.95); }
  .tab-btn[data-floor="4"]{ background:rgba(216,255,214,.95); }
  .tab-btn[data-floor="5"]{ background:rgba(255,242,191,.95); }

  .tab-btn.active{
    background:#2563eb;
    color:#fff;
    box-shadow:0 6px 14px rgba(37,99,235,.45);
    transform:translateY(-1px);
    font-weight:600;
  }

  .tab-btn:active{ transform:translateY(0); box-shadow:none; }

  .floor-blurb{ margin-bottom:6px; }
  .floor-title{
    font-size:1.05rem;
    font-weight:600;
    margin-bottom:4px;
  }

  .badge-row{
    display:inline-flex;
    align-items:center;
    gap:4px;
    font-size:.72rem;
    padding:2px 9px;
    border-radius:999px;
    margin-left:6px;
  }
  .badge-2{ background:var(--p1); }
  .badge-3{ background:var(--p2); }
  .badge-4{ background:var(--p3); }
  .badge-5{ background:var(--p4); }

  .helper-text{ font-size:.8rem; color:var(--muted); }

  .table-wrap{
    max-height:72vh;
    overflow:auto;
    border-radius:16px;
    border:1px solid rgba(148,163,184,.35);
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:.9rem;
    background:#fff;
  }

  thead{
    position:sticky;
    top:0;
    background:#eef2ff;
    z-index:1;
  }

  th,td{
    padding:7px 6px;
    text-align:left;
    vertical-align:top;
  }

  th{
    font-size:.78rem;
    text-transform:uppercase;
    letter-spacing:.04em;
    color:#4b5563;
    border-bottom:1px solid #c7d2fe;
    background:#eef2ff;
  }

  tbody tr:nth-child(even) td{ background:#f9fafb; }
  tbody tr:nth-child(odd) td{ background:#ffffff; }

  tbody tr:hover td{ background:#f1f5ff; }

  .room-col{ width:70px; font-weight:600; white-space:nowrap; }
  .check-col{ width:80px; text-align:center; }
  .notes-col{ width:auto; }

  .notes-input{
    width:100%;
    min-width:140px;
    padding:5px 7px;
    border-radius:12px;
    border:1px solid var(--hubNotesBorder);
    font-size:.85rem;
    background:var(--hubNotesBg);
    resize:none;
    overflow:hidden;
    line-height:1.3;
  }

  .notes-input:focus{
    outline:none;
    border-color:var(--ring);
    box-shadow:0 0 0 2px rgba(154,203,255,.55);
    background:#fff;
  }

  .check-wrap{
    display:flex;
    justify-content:center;
    align-items:center;
    padding-top:2px;
  }

  .check-wrap input[type="checkbox"]{
    width:17px;
    height:17px;
    accent-color:#2563eb;
  }

  @media (max-width:700px){
    body{ padding:10px; }
    .card{ padding:12px 12px 16px; }
    th,td{ padding:6px 4px; font-size:.8rem; }
    .notes-input{ font-size:.8rem; }
    .card-header-band{ flex-direction:column; align-items:flex-start; }
    .header-actions{ align-self:flex-end; }
  }

  @media print{
    body{ background:#fff; padding:0; margin:0; }
    .subtitle,.tabs,.card-header-band,.tab-btn,.btn-pill,.sync-pill{ display:none !important; }
    .wrapper{ max-width:none; margin:0; }
    .card{ box-shadow:none; border:none; padding:0; margin:0; }
    .table-wrap{ max-height:none; overflow:visible; border-radius:0; border:none; }
    h1{ font-size:1.4rem; margin:0 0 4px 0; text-align:left; }
    .date-row{ justify-content:flex-start; margin:0 0 6px 0; }
    .date-row input[type="date"]{ border:none; padding:0 4px; border-radius:0; background:#fff; box-shadow:none; }
    table{ font-size:.85rem; }
    th,td{ padding:6px 4px; }
    tbody tr:nth-child(even) td, tbody tr:nth-child(odd) td{ background:#ffffff; }
    .notes-input{ background:#fff; border:1px solid #d1d5db; min-height:40px; }
  }
</style>
</head>

<body>
<div class="wrapper">
  <h1>The Holiday Inn ‚Äî Room Inspection</h1>
  <div class="subtitle">
    Select a floor, mark <strong>Passed / Failed / Not Inspected</strong>, and record any violations or notes.
  </div>

  <div class="date-row">
    <label for="inspectionDate">Inspection Date:</label>
    <input type="date" id="inspectionDate">
  </div>

  <div class="card">
    <div class="card-header-band">
      <div class="card-header-text">
        Your work saves instantly to this device <strong>and</strong> syncs to your Google Sheet (Web App).
        Use <strong>Create PDF</strong> when you‚Äôre ready to file or save a PDF.
      </div>
      <div class="header-actions">
        <span class="sync-pill" id="syncStatus">Sync: ‚Äî</span>
        <button class="btn-pill btn-print" type="button" id="btnPrintFloor"><span class="icon">üñ®Ô∏è</span><span>Create PDF</span></button>
        <button class="btn-pill btn-clear" type="button" id="btnClearFloor"><span class="icon">üßπ</span><span>Clear Floor</span></button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-floor="2">2nd Floor (200s)</button>
      <button class="tab-btn" data-floor="3">3rd Floor (300s)</button>
      <button class="tab-btn" data-floor="4">4th Floor (400s)</button>
      <button class="tab-btn" data-floor="5">5th Floor (500s)</button>
    </div>

    <div class="floor-blurb" id="floorBlurb">
      <div class="floor-title">
        2nd Floor ‚Äî 200 Rooms
        <span class="badge-row badge-2">Rooms 201‚Äì212, 214‚Äì226, 230‚Äì233</span>
      </div>
      <div class="helper-text">Select one status per room and add notes for any violations or comments.</div>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="room-col">ROOM #</th>
            <th class="check-col">PASSED</th>
            <th class="check-col">FAILED</th>
            <th class="check-col">NOT<br>INSPECTED</th>
            <th class="notes-col">NOTES / VIOLATIONS</th>
          </tr>
        </thead>
        <tbody id="floorBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
/** ==========================
 *  SETTINGS
 *  ========================== */
const LOCAL_KEY = "holiday_inn_inspection_state_v8"; // local backup name
const REMOTE_KEY = "holiday_inn_inspection_state_v1"; // google sheet record key

// ‚úÖ Your Google Apps Script Web App URL:
const API_URL = "https://script.google.com/macros/s/AKfycbzvmJ66LwDU6xNyIpZEdbR1Ltp61NOlpBmOjkVo4hQRP-mxL92KOE7dhECN-RNYLxM8/exec";

/** ==========================
 *  STATE (single source of truth)
 *  ========================== */
let state = {
  inspectionDate: "",
  floors: {
    "2": {},
    "3": {},
    "4": {},
    "5": {}
  }
};

function setSyncStatus(text){ document.getElementById("syncStatus").textContent = "Sync: " + text; }

function autoResize(el){
  el.style.height = "auto";
  el.style.height = el.scrollHeight + "px";
}

function range(start, end){
  const out = [];
  for(let i=start;i<=end;i++) out.push(i);
  return out;
}

const floorConfigs = {
  "2": {
    label: "2nd Floor ‚Äî 200 Rooms",
    badgeClass: "badge-2",
    badgeText: "Rooms 201‚Äì212, 214‚Äì226, 230‚Äì233",
    helper: "Select one status per room and add notes for any violations or comments.",
    rooms: [...range(201,212), ...range(214,226), ...range(230,233)]
  },
  "3": {
    label: "3rd Floor ‚Äî 300 Rooms",
    badgeClass: "badge-3",
    badgeText: "Rooms 301‚Äì312, 314‚Äì327, 329‚Äì331",
    helper: "300 wing rooms.",
    rooms: [...range(301,312), ...range(314,327), ...range(329,331)]
  },
  "4": {
    label: "4th Floor ‚Äî 400 Rooms",
    badgeClass: "badge-4",
    badgeText: "Rooms 401‚Äì412, 414‚Äì427, 429‚Äì431",
    helper: "400 wing rooms.",
    rooms: [...range(401,412), ...range(414,427), ...range(429,431)]
  },
  "5": {
    label: "5th Floor ‚Äî 500 Rooms",
    badgeClass: "badge-5",
    badgeText: "Rooms 501‚Äì512, 514‚Äì527, 529‚Äì531",
    helper: "500 wing rooms.",
    rooms: [...range(501,512), ...range(514,527), ...range(529,531)]
  }
};

function getActiveFloor(){
  const btn = document.querySelector(".tab-btn.active");
  return btn ? btn.getAttribute("data-floor") : "2";
}

function ensureRoom(floor, room){
  state.floors[floor] = state.floors[floor] || {};
  if(!state.floors[floor][room]){
    state.floors[floor][room] = { status: "", notes: "" };
  }
}

/** ==========================
 *  LOCAL STORAGE
 *  ========================== */
function saveLocal(){
  try{
    localStorage.setItem(LOCAL_KEY, JSON.stringify(state));
  }catch(e){
    console.warn("Local save failed", e);
  }
}
function loadLocal(){
  try{
    const raw = localStorage.getItem(LOCAL_KEY);
    if(!raw) return false;
    const obj = JSON.parse(raw);
    if(!obj || typeof obj !== "object") return false;
    state = mergeState(state, obj);
    return true;
  }catch(e){
    console.warn("Local load failed", e);
    return false;
  }
}

/** ==========================
 *  REMOTE (GOOGLE SCRIPT)
 *  ========================== */
async function fetchRemote(){
  if(!API_URL) return null;
  try{
    setSyncStatus("loading‚Ä¶");
    const res = await fetch(`${API_URL}?key=${encodeURIComponent(REMOTE_KEY)}`, { method:"GET" });
    const data = await res.json();
    if(data && data.ok && data.json && typeof data.json === "object"){
      setSyncStatus("loaded");
      return data.json;
    }
    setSyncStatus("no remote");
    return null;
  }catch(e){
    console.warn("Remote fetch failed", e);
    setSyncStatus("offline");
    return null;
  }
}

let saveTimer = null;
function scheduleRemoteSave(){
  if(!API_URL) return;
  if(saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(saveRemote, 800);
}

async function saveRemote(){
  try{
    setSyncStatus("saving‚Ä¶");
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ key: REMOTE_KEY, json: state })
    });
    const data = await res.json();
    if(data && data.ok){
      setSyncStatus("saved");
    }else{
      setSyncStatus("save error");
      console.warn("Remote save response:", data);
    }
  }catch(e){
    console.warn("Remote save failed", e);
    setSyncStatus("offline");
  }
}

/** ==========================
 *  MERGE (protects your data)
 *  ========================== */
function mergeState(base, incoming){
  // shallow-safe merge with floor/room preservation
  const out = JSON.parse(JSON.stringify(base));

  if(incoming && typeof incoming === "object"){
    if(typeof incoming.inspectionDate === "string") out.inspectionDate = incoming.inspectionDate;

    if(incoming.floors && typeof incoming.floors === "object"){
      for(const f of ["2","3","4","5"]){
        out.floors[f] = out.floors[f] || {};
        const incFloor = incoming.floors[f];
        if(incFloor && typeof incFloor === "object"){
          for(const roomKey of Object.keys(incFloor)){
            const rec = incFloor[roomKey];
            if(rec && typeof rec === "object"){
              out.floors[f][roomKey] = {
                status: typeof rec.status === "string" ? rec.status : "",
                notes: typeof rec.notes === "string" ? rec.notes : ""
              };
            }
          }
        }
      }
    }
  }
  return out;
}

/** ==========================
 *  UI BUILD
 *  ========================== */
function setFloorBlurb(floor){
  const cfg = floorConfigs[floor];
  const blurb = document.getElementById("floorBlurb");
  blurb.innerHTML = `
    <div class="floor-title">
      ${cfg.label}
      <span class="badge-row ${cfg.badgeClass}">${cfg.badgeText}</span>
    </div>
    <div class="helper-text">${cfg.helper}</div>
  `;
}

function buildTableForFloor(floor){
  const cfg = floorConfigs[floor];
  if(!cfg) return;

  setFloorBlurb(floor);

  const tbody = document.getElementById("floorBody");
  tbody.innerHTML = "";

  cfg.rooms.forEach(roomNum => {
    const room = String(roomNum);
    ensureRoom(floor, room);

    const tr = document.createElement("tr");

    // room #
    const tdRoom = document.createElement("td");
    tdRoom.className = "room-col";
    tdRoom.textContent = room;
    tr.appendChild(tdRoom);

    // helper to make checkbox cell
    const makeCheckCell = (label) => {
      const td = document.createElement("td");
      td.className = "check-col";
      const wrap = document.createElement("div");
      wrap.className = "check-wrap";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.setAttribute("aria-label", label);
      wrap.appendChild(cb);
      td.appendChild(wrap);
      return { td, cb };
    };

    const passed = makeCheckCell("Passed");
    const failed = makeCheckCell("Failed");
    const notins = makeCheckCell("Not Inspected");

    // set initial checks
    const st = state.floors[floor][room].status || "";
    passed.cb.checked = st === "passed";
    failed.cb.checked = st === "failed";
    notins.cb.checked = st === "not_inspected";

    // exclusive logic
    function setStatus(newStatus){
      state.floors[floor][room].status = newStatus;

      passed.cb.checked = newStatus === "passed";
      failed.cb.checked = newStatus === "failed";
      notins.cb.checked = newStatus === "not_inspected";

      saveLocal();
      scheduleRemoteSave();
    }

    passed.cb.addEventListener("change", () => setStatus(passed.cb.checked ? "passed" : ""));
    failed.cb.addEventListener("change", () => setStatus(failed.cb.checked ? "failed" : ""));
    notins.cb.addEventListener("change", () => setStatus(notins.cb.checked ? "not_inspected" : ""));

    tr.appendChild(passed.td);
    tr.appendChild(failed.td);
    tr.appendChild(notins.td);

    // notes
    const tdNotes = document.createElement("td");
    tdNotes.className = "notes-col";
    const ta = document.createElement("textarea");
    ta.className = "notes-input";
    ta.rows = 1;
    ta.placeholder = "Notes / violations‚Ä¶";
    ta.value = state.floors[floor][room].notes || "";
    autoResize(ta);

    ta.addEventListener("input", () => {
      state.floors[floor][room].notes = ta.value;
      autoResize(ta);
      saveLocal();
      scheduleRemoteSave();
    });

    tdNotes.appendChild(ta);
    tr.appendChild(tdNotes);

    tbody.appendChild(tr);
  });
}

function clearCurrentFloor(){
  const floor = getActiveFloor();
  const cfg = floorConfigs[floor];
  if(!cfg) return;

  cfg.rooms.forEach(roomNum => {
    const room = String(roomNum);
    ensureRoom(floor, room);
    state.floors[floor][room] = { status:"", notes:"" };
  });

  saveLocal();
  scheduleRemoteSave();
  buildTableForFloor(floor);
}

/** ==========================
 *  INIT
 *  ========================== */
async function init(){
  // 1) Load local first (fast)
  loadLocal();

  // Date field
  const dateEl = document.getElementById("inspectionDate");
  if(state.inspectionDate) dateEl.value = state.inspectionDate;

  dateEl.addEventListener("change", () => {
    state.inspectionDate = dateEl.value || "";
    saveLocal();
    scheduleRemoteSave();
  });

  // 2) Load remote and merge (if available)
  const remote = await fetchRemote();
  if(remote){
    // merge remote into current (preserves anything already local)
    state = mergeState(state, remote);

    // reflect date after merge
    if(state.inspectionDate) dateEl.value = state.inspectionDate;

    saveLocal(); // keep a backup after remote merge
  }

  // Tabs
  const tabButtons = document.querySelectorAll(".tab-btn");
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      buildTableForFloor(btn.getAttribute("data-floor"));
    });
  });

  // Buttons
  document.getElementById("btnPrintFloor").addEventListener("click", () => window.print());
  document.getElementById("btnClearFloor").addEventListener("click", () => {
    if(confirm("Clear all statuses and notes for this floor?")){
      clearCurrentFloor();
    }
  });

  // Build default floor
  buildTableForFloor(getActiveFloor());
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
